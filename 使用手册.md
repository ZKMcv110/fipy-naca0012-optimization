# NACA0012翼型扰流柱优化项目使用手册

## 项目简介

本项目旨在通过计算流体力学(CFD)仿真和人工智能(AI)优化技术，寻找最优的扰流柱结构参数，以最大化换热效率与流动阻力的比值(Nu/(f^(1/3)))。项目基于FiPy求解器开发，结合现代优化算法，实现自动化参数优化流程。

## 系统要求

- Windows 10/11 或更高版本
- Python 3.8 或更高版本
- 至少8GB内存
- 至少10GB可用磁盘空间

## 安装指南

### 1. 创建虚拟环境

打开命令提示符，导航到项目目录并创建虚拟环境：

```cmd
cd f:\pyProject\fipy_naca0012_2.0
python -m venv myenvs_fipynaca2.0
```

### 2. 激活虚拟环境

```cmd
myenvs_fipynaca2.0\Scripts\activate
```

激活成功后，命令提示符前会显示`(myenvs_fipynaca2.0)`。

### 3. 安装依赖包

```cmd
pip install -r requirements.txt
```

此过程可能需要几分钟时间，取决于网络速度。

## 项目组件详解

### 网格生成模块

**文件**: `网格生成器2_三角形.py`

功能：根据翼型坐标数据文件生成FiPy兼容的网格文件。

使用方法：
```cmd
python 网格生成器2_三角形.py
```

### CFD求解模块

#### 基础求解器
**文件**: `求解器2.py`

功能：计算二维不可压缩流场。

使用方法：
```cmd
python 求解器2.py
```

#### 传热求解器
**文件**: `求解器_pvtnf.py`

功能：同时计算流场和温度场。

使用方法：
```cmd
python 求解器_pvtnf.py
```

#### 参数计算求解器
**文件**: `compute_Nu_f.py`

功能：专门用于计算Nu和f参数，不进行可视化。

使用方法：
```cmd
python compute_Nu_f.py
```

### 优化流程模块

#### 1. 参数采样生成
**文件**: `generate_samples.py`

功能：使用拉丁超立方采样方法生成参数组合。

使用方法：
```cmd
python generate_samples.py
```

输出：`csv_data/parameter_samples.csv`文件，包含250组参数组合。

#### 2. 单案例运行
**文件**: `run_optimization_case.py`

功能：运行单个优化案例。

使用方法：
```cmd
python run_optimization_case.py Tt Ts Tad Tb
```

示例：
```cmd
python run_optimization_case.py 1.0 1.0 0.5 0.5
```

#### 3. 批量案例运行
**文件**: `run_all_cases.py`

功能：批量运行所有采样案例。

使用方法：
```cmd
python run_all_cases.py
```

输出：`csv_data/final_results.csv`文件，包含所有案例的计算结果。

#### 4. AI模型训练
**文件**: `train_ai_models.py`

功能：使用PyTorch训练Nu和f的预测模型。

使用方法：
```cmd
python train_ai_models.py
```

输出：
- `model_Nu.pth`：Nu预测模型
- `model_f.pth`：f预测模型
- `scaler_X.pkl`：输入参数标准化器
- `scaler_Nu.pkl`：Nu标准化器
- `scaler_f.pkl`：f标准化器
- `training_curves.png`：训练过程曲线图

#### 5. AI优化
**文件**: `ai_optimization.py`

功能：使用训练好的AI模型进行参数优化。

使用方法：
```cmd
python ai_optimization.py
```

输出：`csv_data/optimal_parameters.txt`文件，包含最优参数组合。

## 完整优化流程

### 第一阶段：准备阶段

1. 确保C++几何生成程序正常工作
2. 激活虚拟环境
3. 准备好翼型坐标数据文件(`airfoil_array_SYMMETRIC.dat`)

### 第二阶段：数据生成

1. 生成参数采样点：
   ```cmd
   python generate_samples.py
   ```

2. 批量运行CFD计算：
   ```cmd
   python run_all_cases.py
   ```

   注意：此过程可能需要数小时到数天时间，取决于计算机性能和案例数量。

### 第三阶段：AI训练

```cmd
python train_ai_models.py
```

### 第四阶段：参数优化

```cmd
python ai_optimization.py
```

### 第五阶段：结果验证

使用找到的最优参数运行一次完整的CFD仿真进行验证：
```cmd
python run_optimization_case.py <最优Tt> <最优Ts> <最优Tad> <最优Tb>
```

## 参数说明

### 几何参数

- **Tt (Top thickness)**：扰流柱顶部厚度参数，范围[0.5, 1.5]
- **Ts (Side thickness)**：扰流柱侧面厚度参数，范围[0.5, 1.5]
- **Tad (Angle at front)**：扰流柱前缘角度参数，范围[0.1, 1.0]
- **Tb (Angle at back)**：扰流柱后缘角度参数，范围[0.1, 1.0]

### 物理参数

- **Nu (Nusselt number)**：努塞尔数，表征对流换热强度
- **f (Friction factor)**：摩擦因子，表征流动阻力大小
- **目标参数 Nu/(f^(1/3))**：综合性能评价指标

## 结果文件说明

### csv_data/parameter_samples.csv
参数采样结果文件，包含以下列：
- case_id：案例编号
- Tt, Ts, Tad, Tb：四个几何参数

### csv_data/final_results.csv
CFD计算结果文件，包含以下列：
- case_id：案例编号
- Tt, Ts, Tad, Tb：四个几何参数
- Nu：努塞尔数
- f：摩擦因子
- target_param：目标参数Nu/(f^(1/3))

### csv_data/optimal_parameters.txt
AI优化结果文件，包含找到的最优参数组合和对应的目标参数值。

## 常见问题与解决方案

### 1. 依赖包安装失败

**问题**：安装过程中出现网络错误或依赖冲突。

**解决方案**：
- 检查网络连接
- 尝试使用国内镜像源安装：
  ```cmd
  pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
  ```

### 2. CFD求解发散

**问题**：CFD计算过程中出现发散或NaN值。

**解决方案**：
- 检查网格质量，尝试重新生成网格
- 调整松弛因子
- 检查边界条件设置是否合理

### 3. AI模型预测不准确

**问题**：AI模型预测结果与实际CFD计算结果偏差较大。

**解决方案**：
- 增加训练数据量
- 调整神经网络结构
- 检查数据质量和分布

### 4. 内存不足

**问题**：运行过程中出现内存不足错误。

**解决方案**：
- 关闭其他占用内存的程序
- 减少批量运行的案例数量
- 降低网格分辨率

## 性能优化建议

1. **并行计算**：对于批量案例运行，可以考虑使用并行计算提高效率
2. **网格优化**：在保证精度的前提下，适当降低网格分辨率以减少计算时间
3. **硬件升级**：使用更高性能的CPU和更大的内存可以显著提高计算速度
4. **结果缓存**：对于已经计算过的案例，可以缓存结果避免重复计算

## 技术支持

如遇到无法解决的问题，请联系项目维护人员或在相关技术论坛寻求帮助。